<!DOCTYPE html>
<html>
<head>
    <title>Student Upload - WORKING</title>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 50px auto; padding: 20px; background: #f5f5f5; }
        .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #2563eb; }
        .form-group { margin: 20px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; }
        button { background: #2563eb; color: white; padding: 15px 30px; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; width: 100%; }
        button:hover { background: #1d4ed8; }
        .result { margin-top: 20px; padding: 15px; border-radius: 5px; }
        .success { background: #d1fae5; border: 1px solid #10b981; color: #065f46; }
        .error { background: #fee2e2; border: 1px solid #ef4444; color: #991b1b; }
        .credentials { margin-top: 20px; max-height: 400px; overflow-y: auto; background: #f9fafb; padding: 15px; border-radius: 5px; }
        .credential-item { padding: 8px; border-bottom: 1px solid #e5e7eb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì§ Student Upload System</h1>
        <p>Upload your Excel (.xls or .xlsx) file with student names</p>
        
        <div class="form-group">
            <label>1. Login Token (get from browser console: localStorage.getItem('token'))</label>
            <input type="text" id="token" placeholder="Paste your token here">
        </div>

        <div class="form-group">
            <label>2. Select Excel File</label>
            <input type="file" id="file" accept=".xls,.xlsx">
        </div>

        <div class="form-group">
            <label>3. Department</label>
            <select id="department">
                <option value="LSV">LSV - Land Surveying</option>
                <option value="Software Development">Software Development</option>
                <option value="Computer System and Architecture">Computer System and Architecture</option>
                <option value="Building Construction">Building Construction</option>
                <option value="ICT">ICT</option>
            </select>
        </div>

        <div class="form-group">
            <label>4. Level</label>
            <select id="level">
                <option value="L3">L3</option>
                <option value="L4">L4</option>
                <option value="L5">L5</option>
                <option value="L6">L6</option>
            </select>
        </div>

        <button onclick="uploadFile()">üöÄ Upload Students</button>

        <div id="result"></div>
    </div>

    <script>
        async function uploadFile() {
            const token = document.getElementById('token').value;
            const file = document.getElementById('file').files[0];
            const department = document.getElementById('department').value;
            const level = document.getElementById('level').value;
            const resultDiv = document.getElementById('result');

            if (!token) {
                resultDiv.innerHTML = '<div class="result error">‚ùå Please enter your login token</div>';
                return;
            }

            if (!file) {
                resultDiv.innerHTML = '<div class="result error">‚ùå Please select a file</div>';
                return;
            }

            resultDiv.innerHTML = '<div class="result">‚è≥ Uploading and processing...</div>';

            try {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('department', department);
                formData.append('level', level);

                const response = await fetch('http://localhost:8000/admin/upload-students-excel', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                });

                const data = await response.json();

                if (response.ok) {
                    let html = `<div class="result success">
                        <h3>‚úÖ ${data.message}</h3>
                        <p><strong>Total Students:</strong> ${data.total}</p>
                        <p><strong>New Students:</strong> ${data.created}</p>
                        <p><strong>Updated Students:</strong> ${data.updated}</p>
                        <p><strong>Department:</strong> ${data.department}</p>
                        <p><strong>Level:</strong> ${data.level}</p>
                    </div>`;

                    if (data.credentials && data.credentials.length > 0) {
                        html += '<div class="credentials"><h4>üìã Student Credentials:</h4>';
                        data.credentials.forEach(cred => {
                            html += `<div class="credential-item">
                                <strong>${cred.full_name}</strong><br>
                                Username: ${cred.username} | Password: ${cred.password}
                            </div>`;
                        });
                        html += '</div>';
                    }

                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.innerHTML = `<div class="result error">‚ùå Upload failed: ${data.detail || JSON.stringify(data)}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">‚ùå Error: ${error.message}</div>`;
            }
        }

        // Auto-fill token if available
        window.onload = function() {
            const token = localStorage.getItem('token');
            if (token) {
                document.getElementById('token').value = token;
            }
        };
    </script>
</body>
</html>
